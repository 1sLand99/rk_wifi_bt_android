```
我有一个小板子  接了一个麦克风   再接一个喇叭   再接一个蓝牙PCM

OK，这里就是有3个声卡


正常的小白都是这样想的，但是一个声卡有i2s in  也有i2s out   in接麦克风  out接喇叭，所以一个声卡既有麦克风，也有喇叭，除非他不接，不然就是有


所以有两个声卡就可以了，一个是蓝牙的pcm接口算一个声卡，还有一个是麦克风+喇叭

我们目前默认就是蓝牙PCM为声卡1  系统麦克风+喇叭为声卡2


我们的BR/EDR要上的产品就是有蓝牙音频的，这个才卖的比较赚钱

先看看A2DP
```
a2dp sbc流音乐传输路径图

手机音乐=>手机串口=>手机模组=>ACL=>耳机模组=>蓝牙耳机串口=>系统=>apaly 声卡2
```

这个声卡2就是就是有喇叭又有麦克风的，我们把音乐播放到声卡2上面去，如果系统有其它声卡，也可以把音乐播放到其它声卡

播放，播放，播放，兄弟，如果声卡2被占用了怎么办？

我们经常遇到好不，播放着音乐，地图导航的声音来了，在蓝牙a2dpstream安卓上面，会申请audio focus的特权，这个东东的意思就是

我要申请声卡2的喇叭，我现在要播放蓝牙音乐，你们本地不能播放了，当然也有audio focus change的中断发生，所以和本地播放可以协调

在linux上，就比较手动一点，直接用apaly指令控制吧


然后是
```
sco over hci 语音流传输路径图

手机声卡2麦克风=>系统=>手机串口=>手机模组=>sco=>耳机模组=>耳机串口=>系统=>耳机声卡2
```

然后是
```
sco over pcm 语音流传输路径图

手机声卡2麦克风=>系统=>手机声卡1=>手机模组=>sco=>耳机模组=>耳机声卡1=>系统=>耳机声卡2
```


对比看来一下，其实就是那个声卡1，那就是换成了PCM接口


与串口一样，大家设置要一样，我们有没有遇到经常终端打不出东西的，那是因为自己的串口设置和人家输出的不一样，


所以PCM也是一样，大家需要匹配，所以，他妈的，这里的工作经常有很多，就是因为PCM口不匹配，没有很常使用，设置不熟练还有改哪个地方不知道


所以经常有说，哎呀，播放音乐的时候，apaly pcm接口没有声音，因为这个兄弟不知道语音才会走sco，sco over pcm才可以调试PCM接口


SCO over PCM
arecord -Dhw:1,0 -r 8000 -c 2 -f S16_LE |aplay -r 8000 -c 2 -f S16_LE // 音箱端播放远程电话的声音
arecord -D 2mic_loopback -r 8000 -f S16_LE -c 2 |aplay -D hw:1,0 -r 8000 -c 2 -f S16_LE // 将音箱端的录音推送到远程电话

这个是linux的，介绍一下，目前蓝牙声卡就是hw:1,0 ，arecord就是录制的意思，哈，一个管道，这边取来那边播，apaly就是播放的意思，
apaly播放会直接默认播放到声卡2，系统设置的，蓝牙声卡接的可不是喇叭，2mic_loopback是什么鬼，就是声卡2麦克风的意思



a) bluealsa-aplay -v --profile-sco bt_mac （ 配对手机的蓝牙MAC 地址， 格式为D8:1D:72:1C:26:DC） // 音箱端播放远程电话的声音
b) arecord -r 8000 -f S16_LE -c 2|aplay -D bluealsa:HCI=hci0,DEV= bt mac,PROFILE=sco -t raw -r 8000 -f S16_LE -c 2
// 将音箱端的录音推送到远程电话
// 如果b)不通，可以尝试c)将音箱本地的wav 推送到远程电话测试：
c) aplay -D bluealsa:HCI=hci0,DEV=bt_mac,PROFILE=sco /data/test /Front_Right.wav
```

我们用声卡1和声卡2就很好分析了





















































